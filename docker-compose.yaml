services:
  db:
    image: gvenzl/oracle-xe:latest
    container_name: Oracle
    ports:
      - '1521:1521'
    environment:
      ORACLE_PASSWORD: 12345
      ORACLE_USER: system
    volumes:
      - data:/opt/oracle/oradata
    networks:
      - private_network
    privileged: true
    tty: true
    healthcheck:
      test: ["CMD", "sqlplus", "-S", "/ AS SYSDBA", "<<EOF", "SELECT 1 FROM DUAL;", "EXIT;", "EOF"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 3m

  api :
    container_name: esg-fiap-java
    ports:
      - '8080:8080'
    depends_on:
       db:
          condition: service_healthy
    build: .
    image: esg-fiap-java:lastest
    tty: true
    environment:
      - SPRING_PROFILES_ACTIVE=prd
      - SPRING_DATASOURCE_URL=jdbc:oracle:thin:@db:1521:xe
      - SPRING_DATASOURCE_USERNAME=system
      - SPRING_DATASOURCE_PASSWORD=12345
    networks:
      - public_network
      - private_network

volumes:
  data:

networks:
  public_network:
    driver: bridge
  private_network:
    driver: bridge
